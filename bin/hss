#!/usr/bin/env ruby

require 'hss'

My_Handler = HSS::Handler.new(config: ENV['HSS_CONFIG'])

if ARGV == ['version']
  puts HSS::VERSION
  exit
elsif ARGV == ['help'] || ARGV.empty?
  puts 'How to use:'
  puts '(what you type) -> (where it takes you)'
  My_Handler.patterns.each { |pattern| puts pattern['example'] }
  exit
end

short_host = ARGV.delete_at(ARGV.find_index { |x| x[0, 1] != '-' } || 0)
args = ARGV.reduce('') { |a, e| a + " '" + e.gsub(/([$"])/, '\1') + "'" }
command = ENV.include?('HSS_DEBUG') ? 'echo ssh' : 'ssh'

long_host = My_Handler.handle short_host

$stdout.syswrite "\033]0;#{short_host}\007" if $stdout.tty? && $stdin.tty?
exec "#{command} #{long_host} #{args}"
